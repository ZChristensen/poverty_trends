title=paste(country, "\n",Consumption,"Trends")
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/NP20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","NP20average","Nrestaverage","Year")]
names(new)=c("CountryName","National P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
# p=ggplot(data=new, aes(x=Year, y=Nrestaverage))+ geom_line(aes(y=NP20average, colour="National P20"))+ geom_line(aes(y=Nrestaverage, colour="Rest"))+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year")+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
P20main <- read.csv("~/Poverty data/P20incometrends20180608.csv")
P20main$Consumption=NA
P20main$Consumption[which(P20main$DataType==0)]="Consumption"
P20main$Consumption[which(P20main$DataType==1)]="Income"
keep=c("CountryName","P20average","restaverage","P20Headcount","P20pop","restpop","ExtPovHC","RequestYear","RegionCID","Consumption","NP20average","Nrestaverage" )
P20main2=P20main[,keep]
names(P20main2)[which(names(P20main2)=="P20Headcount")] <- "Percent.in.P20"
names(P20main2)[which(names(P20main2)=="ExtPovHC")] <- "Percent.in.Extreme.Poverty"
names(P20main2)[which(names(P20main2)=="RequestYear")] <- "Year"
regions=unique(P20main$RegionCID)
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/P20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","P20average","restaverage","Year")]
names(new)=c("CountryName","P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/NP20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","NP20average","Nrestaverage","Year")]
names(new)=c("CountryName","National P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
# p=ggplot(data=new, aes(x=Year, y=Nrestaverage))+ geom_line(aes(y=NP20average, colour="National P20"))+ geom_line(aes(y=Nrestaverage, colour="Rest"))+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year")+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
# p=ggplot(data=new, aes(x=Year, y=Nrestaverage))+ geom_line(aes(y=NP20average, colour="National P20"))+ geom_line(aes(y=Nrestaverage, colour="Rest"))+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year")+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)
print(p)
P20main <- read.csv("~/Poverty data/P20incometrends20180608.csv")
P20main$Consumption=NA
P20main$Consumption[which(P20main$DataType==0)]="Consumption"
P20main$Consumption[which(P20main$DataType==1)]="Income"
keep=c("CountryName","RequestYear","P20average","restaverage","P20Headcount","P20pop","restpop","ExtPovHC","RegionCID","Consumption","NP20average","Nrestaverage" )
P20main2=P20main[,keep]
names(P20main2)[which(names(P20main2)=="P20Headcount")] <- "Percent.in.P20"
names(P20main2)[which(names(P20main2)=="ExtPovHC")] <- "Percent.in.Extreme.Poverty"
names(P20main2)[which(names(P20main2)=="RequestYear")] <- "Year"
regions=unique(P20main$RegionCID)
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/P20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","P20average","restaverage","Year")]
names(new)=c("CountryName","P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(y=0)
print(p)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=0)
print(p)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=c(0,0))
print(p)
P20main <- read.csv("~/Poverty data/P20incometrends20180608.csv")
P20main$Consumption=NA
P20main$Consumption[which(P20main$DataType==0)]="Consumption"
P20main$Consumption[which(P20main$DataType==1)]="Income"
keep=c("CountryName","RequestYear","P20average","restaverage","P20Headcount","P20pop","restpop","ExtPovHC","RegionCID","Consumption","NP20average","Nrestaverage" )
P20main2=P20main[,keep]
names(P20main2)[which(names(P20main2)=="P20Headcount")] <- "Percent.in.P20"
names(P20main2)[which(names(P20main2)=="ExtPovHC")] <- "Percent.in.Extreme.Poverty"
names(P20main2)[which(names(P20main2)=="RequestYear")] <- "Year"
regions=unique(P20main$RegionCID)
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/P20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","P20average","restaverage","Year")]
names(new)=c("CountryName","P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=c(0,0))
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/NP20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","NP20average","Nrestaverage","Year")]
names(new)=c("CountryName","National P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
# p=ggplot(data=new, aes(x=Year, y=Nrestaverage))+ geom_line(aes(y=NP20average, colour="National P20"))+ geom_line(aes(y=Nrestaverage, colour="Rest"))+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year")+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=c(0,0))
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
list.of.packages <- c("readr","data.table","plyr","Hmisc","reshape2","varhandle")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
load("E:/Common DHS boundaries/svy_boundaries_1.RData")
View(svy_boundaries_1)
load("E:/Common DHS boundaries/svy_boundaries_2.RData")
load("E:/Common DHS boundaries/svy_boundaries_3.RData")
list.of.packages <- c("readr","Hmisc","data.table")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd = "E:/Common DHS boundaries"
setwd(wd)
?rbind
rbind(svy_boundaries_1,svy_boundaries_2,svy_boundaries_3)
?rbind.SpatialMultiPoints
typeof(svy_boundaries_1)
?rbind.SpatialPolygonsDataFrame
allboundaries=rbind.SpatialPolygonsDataFrame(svy_boundaries_1,svy_boundaries_2)
allboundaries=rbind.SpatialPolygonsDataFrame(allboundaries,svy_boundaries_3)
unique(allboundaries$CNTRYNAMEE)
allboundaries=rbind.SpatialPolygonsDataFrame(svy_boundaries_1,svy_boundaries_2)
allboundaries2=rbind.SpatialPolygonsDataFrame(allboundaries,svy_boundaries_3)
table(allboundaries2$CNTRYNAMEE,allboundaries2$SVYYEAR)
names(allboundaries2)
load("E:/git/poverty_trends/data/AGGPovcalScrapeSept2018.RData")
list.of.packages <- c("plyr","data.table","varhandle","ggplot2","reshape2","readr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
#Loading PovcalNet data
if(.Platform$OS.type == "unix"){
prefix = "~"
}else{
prefix = "E:"
}
wd = paste0(prefix,"/git/poverty_trends/")
setwd(wd)
load("data/AGGPovcalScrape1May2018.RData")
load("data/SMYPovcalScrape1May2018_low.RData")
load("data/SMYPovcalScrape1May2018_high.RData")
agg_total=unique(agg_total)
#Assessing updates to PovcalNet
list.of.packages <- c("plyr","data.table","varhandle","ggplot2","reshape2","readr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
#Loading PovcalNet data
if(.Platform$OS.type == "unix"){
prefix = "~"
}else{
prefix = "E:"
}
wd = paste0(prefix,"/git/poverty_trends/")
setwd(wd)
#Assessing updates to PovcalNet
list.of.packages <- c("plyr","data.table","varhandle","ggplot2","reshape2","readr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
#Loading PovcalNet data
if(.Platform$OS.type == "unix"){
prefix = "~"
}else{
prefix = "E:"
}
wd = paste0(prefix,"/git/poverty_trends/")
setwd(wd)
#Loading PovcalNet data
load("data/AGGPovcalScrapeSept2018.RData")
agg_total$ConsumptionFloor = agg_total$povertyLine*(1-(agg_total$p2/agg_total$pg))
agg_total$diff=abs(agg_total$hc-0.2)
regional.extpov = subset(agg_total, povertyLine==1.90)
GlobalExtPov = subset(regional.extpov, regionTitle=="World Total")
names(GlobalExtPov)[which(names(GlobalExtPov)=="ConsumptionFloor")] <- "Global.Consumption.Floor"
names(GlobalExtPov)[which(names(GlobalExtPov)=="hc")] <- "Global.Ext.HC"
keep=c("requestYear","Global.Consumption.Floor","Global.Ext.HC")
GlobalExtPov=GlobalExtPov[,keep,with=F]
regional.p20 = data.table(agg_total)[,.SD[which.min(diff)],by=.(regionTitle,requestYear)]
WorldP20threshold = subset(regional.p20, regionTitle=="World Total")
WorldP20threshold$P20Threshold = WorldP20threshold$povertyLine
WorldP20threshold$P20pop=WorldP20threshold$population*.2
WorldP20threshold$P20average=WorldP20threshold$povertyLine -((WorldP20threshold$povertyLine*(WorldP20threshold$pg)*WorldP20threshold$population)/(WorldP20threshold$population*.2))
WorldP20threshold$restpop = WorldP20threshold$pop - WorldP20threshold$P20pop
WorldP20threshold$Restaverage=((WorldP20threshold$mean/(365/12)*WorldP20threshold$pop)-(WorldP20threshold$P20average*WorldP20threshold$P20pop))/WorldP20threshold$restpop
World=WorldP20threshold[,c("requestYear","P20average","ConsumptionFloor","Restaverage")]
World=join(World,GlobalExtPov,by=c("requestYear"))
World=World[order(World$requestYear),]
World[,c("P20_growth","rest_growth","yrchange"):=list(c(NA,diff(.SD$P20average)),c(NA,diff(.SD$Restaverage)),c(NA,diff(.SD$requestYear)))]
World$P20_rate=(World$P20_growth/World$yrchange)/World$P20average
World$Rest_rate=(World$rest_growth/World$yrchange)/World$Restaverage
View(World)
regional.extpov = subset(agg_total, povertyLine==1.90)
GlobalExtPov = subset(regional.extpov, regionTitle=="World Total")
names(GlobalExtPov)[which(names(GlobalExtPov)=="ConsumptionFloor")] <- "Global.Consumption.Floor"
names(GlobalExtPov)[which(names(GlobalExtPov)=="hc")] <- "Global.Ext.HC"
keep=c("requestYear","Global.Consumption.Floor","Global.Ext.HC")
GlobalExtPov=GlobalExtPov[,keep,with=F]
regional.LMpov=subset(agg_total, povertyLine==3.2)
GlobalLMpov=subset(regional.LMpov,regionTitle=="World Total")
names(GlobalLMpov)[which(names(GlobalLMpov)=="hc")] = "Global.LM.HC"
GlobalLMpov=GlobalLMpov[,c("requestYear","Global.LM.HC"), with=F]
regional.UMpov=subset(agg_total, povertyLine==5.5)
GlobalUMpov=subset(regional.UMpov,regionTitle=="World Total")
names(GlboalUMpov)[which(names(GlobalUMpov)=="hc")] = "Global.UM.HC"
GlobalUMpov=GlobalUMpov[,c("requestYear","Global.UM.HC"),with=F]
names(agg_total)
View(regional.LMpov)
View(GlobalLMpov)
View(GlobalUMpov)
names(GlboalUMpov)
names(GlobalUMpov)[which(names(GlobalUMpov)=="hc")] = "Global.UM.HC"
GlobalUMpov=GlobalUMpov[,c("requestYear","Global.UM.HC"),with=F]
View(GlobalUMpov)
GlobalThreeLines=join_all(c("GlobalExtPov","GlobalLMpov","GlobalUMpov"),by=c("requestYear"))
is.data.frame(GlobalExtPov)
is.data.frame(GlobalLMpov)
is.data.frame(GlobalUMpov)
?join_all
GlobalThreeLines=join_all(list("GlobalExtPov","GlobalLMpov","GlobalUMpov"),by=c("requestYear"))
GlobalThreeLines=join_all(list(GlobalExtPov,GlobalLMpov,GlobalUMpov),by=c("requestYear"))
View(GlobalThreeLines)
regional.p20 = data.table(agg_total)[,.SD[which.min(diff)],by=.(regionTitle,requestYear)]
WorldP20threshold = subset(regional.p20, regionTitle=="World Total")
WorldP20threshold$P20Threshold = WorldP20threshold$povertyLine
WorldP20threshold$P20pop=WorldP20threshold$population*.2
WorldP20threshold$P20average=WorldP20threshold$povertyLine -((WorldP20threshold$povertyLine*(WorldP20threshold$pg)*WorldP20threshold$population)/(WorldP20threshold$population*.2))
WorldP20threshold$restpop = WorldP20threshold$pop - WorldP20threshold$P20pop
WorldP20threshold$Restaverage=((WorldP20threshold$mean/(365/12)*WorldP20threshold$pop)-(WorldP20threshold$P20average*WorldP20threshold$P20pop))/WorldP20threshold$restpop
World=WorldP20threshold[,c("requestYear","P20average","ConsumptionFloor","Restaverage")]
World=join(World,GlobalThreeLines,by=c("requestYear"))
World=World[order(World$requestYear),]
World[,c("P20_growth","rest_growth","ext.hc.growth","lm.hc.growth","um.hc.gowth","yrchange"):=
list(c(NA,diff(.SD$P20average))
,c(NA,diff(.SD$Restaverage))
,c(NA,diff(.SD$Global.Ext.HC))
,c(NA,diff(.SD$Global.LM.HC))
,c(NA,diff(.SD$Global.UM.HC))
,c(NA,diff(.SD$requestYear)))]
regional.p20 = data.table(agg_total)[,.SD[which.min(diff)],by=.(regionTitle,requestYear)]
WorldP20threshold = subset(regional.p20, regionTitle=="World Total")
WorldP20threshold$P20Threshold = WorldP20threshold$povertyLine
WorldP20threshold$P20pop=WorldP20threshold$population*.2
WorldP20threshold$P20average=WorldP20threshold$povertyLine -((WorldP20threshold$povertyLine*(WorldP20threshold$pg)*WorldP20threshold$population)/(WorldP20threshold$population*.2))
WorldP20threshold$restpop = WorldP20threshold$pop - WorldP20threshold$P20pop
WorldP20threshold$Restaverage=((WorldP20threshold$mean/(365/12)*WorldP20threshold$pop)-(WorldP20threshold$P20average*WorldP20threshold$P20pop))/WorldP20threshold$restpop
World=WorldP20threshold[,c("requestYear","P20average","ConsumptionFloor","Restaverage")]
World=join(World,GlobalThreeLines,by=c("requestYear"))
World=World[order(World$requestYear),]
World[,c("P20_growth","rest_growth","ext.hc.growth","lm.hc.growth","um.hc.gowth","yrchange"):=
list(c(NA,diff(.SD$P20average))
,c(NA,diff(.SD$Restaverage))
,c(NA,diff(.SD$Global.Ext.HC))
,c(NA,diff(.SD$Global.LM.HC))
,c(NA,diff(.SD$Global.UM.HC))
,c(NA,diff(.SD$requestYear)))]
World$P20_rate=(World$P20_growth/World$yrchange)/World$P20average
World$Rest_rate=(World$rest_growth/World$yrchange)/World$Restaverage
World$ext_hc_rate=(World$ext.hc.growth/World$yrchange)/World$ext.hc.growth
World$lm_hc_rate=(World$lm.hc.growth/World$yrchange)/World$lm.hc.growth
World$um_hc_rate=(World$um.hc.growth/World$yrchange)/World$um.hc.growth
ggplot(WorldP20threshold[which(WorldP20threshold$requestYear==2013|WorldP20threshold$requestYear==2015),], aes(x=requestYear))+
geom_line(aes(x=requestYear,y=ext_hc_rate))+
geom_line(aes(x=requestYear,y=um_hc_rate))+
geom_line(aes(x=requestYear,y=lm_hc_rate))+
labs(x="Year",y="Average daily income per capita\n$2011 PPP",title="The gap between the P20 and the rest of the population is growing")+
theme_classic()
ggplot(World[which(World$requestYear==2013|World$requestYear==2015),], aes(x=requestYear))+
geom_line(aes(x=requestYear,y=ext_hc_rate))+
geom_line(aes(x=requestYear,y=um_hc_rate))+
geom_line(aes(x=requestYear,y=lm_hc_rate))+
labs(x="Year",y="Average daily income per capita\n$2011 PPP",title="The gap between the P20 and the rest of the population is growing")+
theme_classic()
View(World)
.1373-.1279
WorldP20threshold = subset(regional.p20, regionTitle=="World Total")
WorldP20threshold$P20Threshold = WorldP20threshold$povertyLine
WorldP20threshold$P20pop=WorldP20threshold$population*.2
WorldP20threshold$P20average=WorldP20threshold$povertyLine -((WorldP20threshold$povertyLine*(WorldP20threshold$pg)*WorldP20threshold$population)/(WorldP20threshold$population*.2))
WorldP20threshold$restpop = WorldP20threshold$pop - WorldP20threshold$P20pop
WorldP20threshold$Restaverage=((WorldP20threshold$mean/(365/12)*WorldP20threshold$pop)-(WorldP20threshold$P20average*WorldP20threshold$P20pop))/WorldP20threshold$restpop
World=WorldP20threshold[,c("requestYear","P20average","ConsumptionFloor","Restaverage")]
World=join(World,GlobalThreeLines,by=c("requestYear"))
World=World[order(World$requestYear),]
World[,c("P20_growth","rest_growth","ext.hc.growth","lm.hc.growth","um.hc.gowth","yrchange"):=
list(c(NA,diff(.SD$P20average))
,c(NA,diff(.SD$Restaverage))
,c(NA,diff(.SD$Global.Ext.HC))
,c(NA,diff(.SD$Global.LM.HC))
,c(NA,diff(.SD$Global.UM.HC))
,c(NA,diff(.SD$requestYear)))]
World$P20_rate=(World$P20_growth/World$yrchange)/World$P20average
World$Rest_rate=(World$rest_growth/World$yrchange)/World$Restaverage
World$ext_hc_rate=(World$ext.hc.growth/World$yrchange)
World$lm_hc_rate=(World$lm.hc.growth/World$yrchange)
World$um_hc_rate=(World$um.hc.growth/World$yrchange)
View(World)
View(World)
ggplot(World), aes(x=requestYear))+geom_line(aes(x=requestYear,y=P20average,group=P20average,color=P20average))+geom_line(aes(x=requestYear,y=Restaverage,group=Restaverage,color=Restaverage))+classic_theme()
ggplot(World, aes(x=requestYear))+geom_line(aes(x=requestYear,y=P20average,group=P20average,color=P20average))+geom_line(aes(x=requestYear,y=Restaverage,group=Restaverage,color=Restaverage))+classic_theme()
ggplot(World, aes(x=requestYear))+geom_line(aes(x=requestYear,y=P20average,group=P20average,color=P20average))+geom_line(aes(x=requestYear,y=Restaverage,group=Restaverage,color=Restaverage))+theme_classic()
ggplot(World, aes(x=requestYear))+geom_line(aes(x=requestYear,y=P20average)+geom_line(aes(x=requestYear,y=Restaverage))+theme_classic()
)
View(World)
ggplot(World, aes(x=requestYear))+geom_line(aes(x=requestYear,y=P20average))+geom_line(aes(x=requestYear,y=Restaverage))+theme_classic()
load("E:/git/poverty_trends/data/AGGPovcalScrapeSept2018.RData")
agg_total$ConsumptionFloor = agg_total$povertyLine*(1-(agg_total$p2/agg_total$pg))
agg_total$diff=abs(agg_total$hc-.20)
regional.extpov = subset(agg_total, povertyLine==1.90)
GlobalExtPov = subset(regional.extpov, regionTitle=="World Total")
names(GlobalExtPov)[which(names(GlobalExtPov)=="ConsumptionFloor")] <- "Global.Consumption.Floor"
names(GlobalExtPov)[which(names(GlobalExtPov)=="hc")] <- "Global.Ext.HC"
GlobalExtPov=GlobalExtPov[,c("requestYear","Global.Consumption.Floor","Global.Ext.HC")]
regional.p20 = data.table(agg_total)[,.SD[which.min(diff)],by=.(regionTitle,requestYear)]
WorldP20threshold = subset(regional.p20, regionTitle=="World Total")
WorldP20threshold$P20Threshold = WorldP20threshold$povertyLine
WorldP20threshold2=data.frame(WorldP20threshold)[,c("requestYear","P20Threshold")]
P20main= data.frame(regional.p20)
P20main$population=P20main$population * 1000000
P20main$P20pop = (P20main$hc)*(P20main$population)
P20main$P20average = P20main$povertyLine -((P20main$povertyLine*P20main$pg*P20main$pop)/P20main$P20pop)
P20main$restpop = P20main$population - P20main$P20pop
P20main$restaverage = (((P20main$mean/(365/12))*P20main$population)-(P20main$P20average * P20main$P20pop))/P20main$restpop
regions=unique(P20main$regionCID)
countries=unique(P20main$regionTitle)
names(P20main)[2]="Year"
country=="World"
country="World"
new=subset(P20main[,which(requestYear>1999)], regionTitle==country)
maximums=max(new$restaverage)+(.05*(max(new$restaverage)))
new=subset(P20main[,which(Year>=1999)], regionTitle==country)
names(P20main)
country="WLD"
new=subset(P20main[,which(Year>=1999)], regionTitle==country)
new=subset(P20main[which(Year>=1999),], regionTitle==country)
new=subset(P20main[which(P20main$Year>=1999),], regionTitle==country)
View(P20main)
new=subset(P20main[which(P20main$Year>=1999),], regionTitle==country)
View(P20main)
new=subset(P20main[which(P20main$Year>=1999),], regionTitle==country)
new=P20main[which(P20main$Year>=1999),]
new=P20main[which(P20main$Year>=1999 & regionTitle=="WLD"),]
View(P20main)
new=P20main[which(P20main$Year>=1999 & regionCID=="WLD"),]
new=P20main[which(P20main$Year>=1999 & P20main$regionCID=="WLD"),]
maximums=max(new$restaverage)+(.05*(max(new$restaverage)))
Consumption="Consumption"
new=new[,c("regionTitle","P20average","restaverage","Year")]
names(new)=c("regionTitle","P20","Rest of population","Year")
new.m=melt(new,id.vars=c("regionTitle","Year"))
title=paste(country, "\n","Trends")
ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+
geom_line()+
labs(title=title,y=paste("Ave. daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+
theme_classic()+
theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+
expand_limits(y=0)+
scale_y_continuous(expand=c(0,0),limits=c(0,maximums),labels=dollar)
#Income gaps
list.of.packages <- c("data.table","excel.link","ggplot2","readr","stringr","scales","Hmisc")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+
geom_line()+
labs(title=title,y=paste("Ave. daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+
theme_classic()+
theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+
expand_limits(y=0)+
scale_y_continuous(expand=c(0,0),limits=c(0,maximums),labels=dollar)
# coord_cartesian(ylim=c(0,max))
ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+
geom_line()+
labs(y=paste("Ave. daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+
theme_classic()+
theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+
expand_limits(y=0)+
scale_y_continuous(expand=c(0,0),limits=c(0,maximums),labels=dollar)
ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+
geom_line()+
labs(y=paste("Ave. daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+
theme_classic()+
theme(title="The gap between the P20 and the rest of the population is growing",legend.title=element_blank(), plot.title=element_text(hjust=0.5))+
expand_limits(y=0)+
scale_y_continuous(expand=c(0,0),limits=c(0,maximums),labels=dollar)
ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+
geom_line()+
labs(title="The gap between the P20 and the rest of the population is growing",y=paste("Ave. daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+
theme_classic()+
theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+
expand_limits(y=0)+
scale_y_continuous(expand=c(0,0),limits=c(0,maximums),labels=dollar)
