print(p)
P20main <- read.csv("~/Poverty data/P20incometrends20180608.csv")
P20main$Consumption=NA
P20main$Consumption[which(P20main$DataType==0)]="Consumption"
P20main$Consumption[which(P20main$DataType==1)]="Income"
keep=c("CountryName","RequestYear","P20average","restaverage","P20Headcount","P20pop","restpop","ExtPovHC","RegionCID","Consumption","NP20average","Nrestaverage" )
P20main2=P20main[,keep]
names(P20main2)[which(names(P20main2)=="P20Headcount")] <- "Percent.in.P20"
names(P20main2)[which(names(P20main2)=="ExtPovHC")] <- "Percent.in.Extreme.Poverty"
names(P20main2)[which(names(P20main2)=="RequestYear")] <- "Year"
regions=unique(P20main$RegionCID)
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/P20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","P20average","restaverage","Year")]
names(new)=c("CountryName","P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(y=0)
print(p)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=0)
print(p)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=c(0,0))
print(p)
P20main <- read.csv("~/Poverty data/P20incometrends20180608.csv")
P20main$Consumption=NA
P20main$Consumption[which(P20main$DataType==0)]="Consumption"
P20main$Consumption[which(P20main$DataType==1)]="Income"
keep=c("CountryName","RequestYear","P20average","restaverage","P20Headcount","P20pop","restpop","ExtPovHC","RegionCID","Consumption","NP20average","Nrestaverage" )
P20main2=P20main[,keep]
names(P20main2)[which(names(P20main2)=="P20Headcount")] <- "Percent.in.P20"
names(P20main2)[which(names(P20main2)=="ExtPovHC")] <- "Percent.in.Extreme.Poverty"
names(P20main2)[which(names(P20main2)=="RequestYear")] <- "Year"
regions=unique(P20main$RegionCID)
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/P20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","P20average","restaverage","Year")]
names(new)=c("CountryName","P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=c(0,0))
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
for(region in regions){
print(region)
filenam=paste0("C:/Users/Zach/Documents/P20 Analysis 2018/Income comparisons P20 and rest/NP20versusRestIncomeTrends20180602",region,".xlsx")
P20main3=subset(P20main2, RegionCID==region)
xl.workbook.add()
countries=unique(P20main3$CountryName)
for(country in countries){
new=subset(P20main3, CountryName==country)
Consumption=unique(new$Consumption)
new=new[,c("CountryName","NP20average","Nrestaverage","Year")]
names(new)=c("CountryName","National P20","Rest of population","Year")
new.m=melt(new,id.vars=c("CountryName","Year"))
title=paste(country, "\n",Consumption,"Trends")
# p=ggplot(data=new, aes(x=Year, y=Nrestaverage))+ geom_line(aes(y=NP20average, colour="National P20"))+ geom_line(aes(y=Nrestaverage, colour="Rest"))+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year")+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)
p=ggplot(data=new.m, aes(x=Year, y=value,group=variable,colour=variable))+geom_line()+labs(title=title,y=paste("Average daily", str_to_lower(Consumption), "per person\nUSD 2011 PPP"),x="Year",colour="")+theme_classic()+theme(legend.title=element_blank(), plot.title=element_text(hjust=0.5))+scale_y_continuous(labels=dollar)+expand_limits(y=0)+ scale_y_continuous(expand=c(0,0))
print(p)
y.plot=current.graphics()
xl.sheet.add(substr(country,1,30))
xl[a1]=y.plot
xl[i1]=t(names(new))
xl[i2]=new
}
xl.sheet.delete("Sheet1")
xl.sheet.delete("Sheet2")
xl.sheet.delete("Sheet3")
xl.workbook.save(filenam)
xl.workbook.close()
}
list.of.packages <- c("readr","data.table","plyr","Hmisc","reshape2","varhandle")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
load("E:/Common DHS boundaries/svy_boundaries_1.RData")
View(svy_boundaries_1)
load("E:/Common DHS boundaries/svy_boundaries_2.RData")
load("E:/Common DHS boundaries/svy_boundaries_3.RData")
list.of.packages <- c("readr","Hmisc","data.table")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd = "E:/Common DHS boundaries"
setwd(wd)
?rbind
rbind(svy_boundaries_1,svy_boundaries_2,svy_boundaries_3)
?rbind.SpatialMultiPoints
typeof(svy_boundaries_1)
?rbind.SpatialPolygonsDataFrame
allboundaries=rbind.SpatialPolygonsDataFrame(svy_boundaries_1,svy_boundaries_2)
allboundaries=rbind.SpatialPolygonsDataFrame(allboundaries,svy_boundaries_3)
unique(allboundaries$CNTRYNAMEE)
allboundaries=rbind.SpatialPolygonsDataFrame(svy_boundaries_1,svy_boundaries_2)
allboundaries2=rbind.SpatialPolygonsDataFrame(allboundaries,svy_boundaries_3)
table(allboundaries2$CNTRYNAMEE,allboundaries2$SVYYEAR)
names(allboundaries2)
load("data/AGGPovcalScrapeSept2018.RData")
load("data/SMYPovcalScrapeSept2018_low.RData")
load("data/SMYPovcalScrapeSept2018_high.RData")
# agg_total=unique(agg_total)
# save(agg_total,file="data/AGGPovcalScrapeSept2018.RData")
smy_total=rbind(smy_total_high,smy_total_low)
smy_total=smy_total[which(smy_total$CoverageType %in% c("N","A")),]
setdiff(smy_total$CountryName,old_smy$CountryName)
setdiff(old_smy$CountryName,smy_total$CountryName)
old_smy$CountryName[which(old_smy$CountryName=="Swaziland")]="Eswatini"
#Global Check
colnames(old_regional) =c("requestYear",
"regionTitle"
,"regionCID"
,"povertyLine"
,"oldmean"
,"oldhc"
,"oldpg"
,"oldp2"
,"oldpopulation"
,"oldConsumptionFloor")
setdiff(old_regional$requestYear,agg_total$requestYear)
setdiff(agg_total$requestYear,old_regional$requestYear)
regions=join(agg_total,old_regional, by=c("requestYear","regionCID","povertyLine"))
agg190=agg_total[which(agg_total$povertyLine==1.9),]
agg190=agg190[order(agg190$regionCID),]
agg190=agg190[order(agg190$requestYear),]
agg190[,c("hc_growth","yrchange"):=list(c(NA,diff(.SD$hc)),c(NA,diff(.SD$requestYear))),by=.(regionCID)]
agg190$annualized_hc_growth=agg190$hc_growth/agg190$yrchange
ggplot(agg190, aes(x=requestYear,y=hc,group=regionCID,color=regionCID))+geom_line()+theme_classic()
ggplot(agg190[which(requestYear>=1999),], aes(x=requestYear,y=hc,group=regionCID,color=regionCID))+geom_line()+theme_classic()
ggplot(agg190[which(requestYear>=2010),], aes(x=requestYear,y=hc,group=regionCID,color=regionCID))+geom_line()+theme_classic()
ggplot(agg190[which(regionCID=="WLD"),], aes(x=requestYear,y=annualized_hc_growth,group=regionCID,color=regionCID))+geom_line()+theme_classic()
ggplot(agg190[which(requestYear>=1999),], aes(x=requestYear,y=annualized_hc_growth,group=regionCID,color=regionCID))+geom_line()+theme_classic()
ggplot(agg190[which(requestYear>=2010),], aes(x=requestYear,y=annualized_hc_growth,group=regionCID,color=regionCID))+geom_line()+theme_classic()
#Regional Check
regions$oldhc=regions$oldhc/100
regions$hcdiff=regions$oldhc-regions$hc
regions$hcdiff_pct=regions$hcdiff/regions$oldhc
big_diff_reg=subset(regions, abs(hcdiff_pct)>.02)
##Big revisions seen for 2005 EAP, decreased HC by 6.9 percentage points, dropping global estimate by 2%
eap=regions[which(regions$regionCID=="EAP"& regions$povertyLine==1.9),]
eap=eap[,c("requestYear","hc","oldhc")]
eap.m=melt(eap,id.vars="requestYear")
ggplot(eap.m,aes(x=requestYear,y=value,group=variable,color=variable))+geom_line()+theme_classic()
# ohi=regions[which(regions$regionCID=="OHI"& regions$povertyLine==1.9),]
# ohi=ohi[,c("requestYear","hc","oldhc")]
# ohi.m=melt(ohi,id.vars="requestYear")
# ggplot(ohi.m,aes(x=requestYear,y=value,group=variable,color=variable))+geom_line()
#Country Check
smy_2015=smy_total[which(smy_total$RequestYear==2015),]
smy_2013=smy_total[which(smy_total$RequestYear==2013),]
setnames(smy_2013,"HeadCount","HeadCount2013")
comparisonsmy=join(smy_2015,smy_2013,by=c("CountryName","PovertyLine"))
comparisonsmy$hcdiff=comparisonsmy$HeadCount-comparisonsmy$HeadCount2013
comparisonsmy$hc_growth=comparisonsmy$hcdiff/comparisonsmy$HeadCount2013
comparisonsmy190=comparisonsmy[which(comparisonsmy$PovertyLine==1.9),]
pov_inc=subset(comparisonsmy190, comparisonsmy190$hcdiff>0)
length(unique(smy_2015$CountryName))
length(unique(pov_inc$CountryName))
unique(comparisonsmy190$CountryName[which(comparisonsmy190$hcdiff>.01)])
unique(comparisonsmy190$CountryName[which(comparisonsmy190$hcdiff>0)])
toppoverty=comparisonsmy190$CountryName[which(rank(comparisonsmy190$hcdiff)<20)]
toppov=smy_total[which(smy_total$CountryName %in% toppoverty & smy_total$PovertyLine==1.9 & smy_total$RequestYear>2005)]
toppov=toppov[,c("RequestYear","HeadCount","CountryName")]
ggplot(toppov,aes(x=RequestYear,y=HeadCount,group=CountryName,color=CountryName))+geom_line()+theme_classic()
CLB=c("Benin",
"Burundi"
,"Central African Republic"
,"Chad"
,"Congo, Republic of"
,"Congo, Democratic Republic of"
,"Gambia, The"
,"Guinea"
,"Guinea-Bissau"
,"Haiti"
,"Lesotho"
,"Liberia"
,"Madagascar"
,"Malawi"
,"Micronesia, Federated States of"
,"Mozambique"
,"Niger"
,"Nigeria"
,"Papua New Guinea"
,"South Sudan"
,"Syrian Arab Republic"
,"Togo"
,"Uganda"
,"Yemen, Republic of"
,"Zambia")
povclb=smy_total[which(smy_total$CountryName %in% CLB & smy_total$PovertyLine==1.9),]
ggplot(povclb[which(povclb$RequestYear>2012)], aes(x=RequestYear))+
geom_line(aes(x=RequestYear,y=HeadCount,group=CountryName,color=CountryName))
smy_total$CLB=NA
smy_total$CLB[which(smy_total$CountryName %in% CLB)]=1
clb.tab=data.table(smy_total[which(smy_total$PovertyLine==1.9)])[,.(
HC=mean(HeadCount)
),by=c("RequestYear","CLB")]
#Elephant graph
masterlist=list()
masterlist.index=1
for (i in seq(.01,1,by=.01)){
print(i)
new=data.table(agg_total[which(agg_total$regionCID=="WLD")])[,.SD[which.min(abs(hc-i))],by=c("requestYear")]
masterlist[[masterlist.index]]=new
masterlist.index=masterlist.index+1
}
master=rbindlist(masterlist)
master=master[,c("hc","povertyLine","requestYear","regionCID")]
master=master[order(master$requestYear, master$hc),]
master$HC=seq(1,100,by=1)
years=c(unique(master$requestYear))
years=years[order(years)]
headcounts=unique(master$hc)
countries=unique(master$regionCID)
master=data.frame(master)
if(exists("masterwide")){
rm(masterwide)
}
for(year in years){
year.values=c()
year.hcs=c()
year.nam=paste0("Income",year)
year.values=subset(master, requestYear==year)[c("HC","povertyLine")]
setnames(year.values,"povertyLine",year.nam)
if(exists("masterwide")){
masterwide=merge(masterwide,year.values,by="HC",all=T)
}
else{
masterwide=year.values
}
}
masterwide$growth87to08rt = ((masterwide$Income2008-masterwide$Income1987)/masterwide$Income1987)/(2008-1987)
masterwide$growth02to13rt = ((masterwide$Income2013-masterwide$Income2002)/masterwide$Income2002)/(2013-2002)
masterwide$growth93to13rt = ((masterwide$Income2013-masterwide$Income1993)/masterwide$Income1993)/(2013-1993)
masterwide$growth08to13rt = ((masterwide$Income2013-masterwide$Income2008)/masterwide$Income2008)/(2013-2008)
masterwide$growth13to15rt = ((masterwide$Income2015-masterwide$Income2013)/masterwide$Income2013)/(2015-2013)
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))
#Assessing updates to PovcalNet
list.of.packages <- c("plyr","data.table","varhandle","ggplot2","reshape2","readr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
#Loading PovcalNet data
if(.Platform$OS.type == "unix"){
prefix = "~"
}else{
prefix = "E:"
}
wd = paste0(prefix,"/git/poverty_trends/")
setwd(wd)
#Loading PovcalNet data
load("data/AGGPovcalScrapeSept2018.RData")
masterlist=list()
masterlist.index=1
for (i in seq(.01,1,by=.01)){
print(i)
new=data.table(agg_total[which(agg_total$regionCID=="WLD")])[,.SD[which.min(abs(hc-i))],by=c("requestYear")]
masterlist[[masterlist.index]]=new
masterlist.index=masterlist.index+1
}
master=rbindlist(masterlist)
master=master[,c("hc","povertyLine","requestYear","regionCID")]
master=master[order(master$requestYear, master$hc),]
master$HC=seq(1,100,by=1)
years=c(unique(master$requestYear))
years=years[order(years)]
headcounts=unique(master$hc)
countries=unique(master$regionCID)
master=data.frame(master)
if(exists("masterwide")){
rm(masterwide)
}
for(year in years){
year.values=c()
year.hcs=c()
year.nam=paste0("Income",year)
year.values=subset(master, requestYear==year)[c("HC","povertyLine")]
setnames(year.values,"povertyLine",year.nam)
if(exists("masterwide")){
masterwide=merge(masterwide,year.values,by="HC",all=T)
}
else{
masterwide=year.values
}
}
masterwide$growth87to08rt = ((masterwide$Income2008-masterwide$Income1987)/masterwide$Income1987)/(2008-1987)
masterwide$growth02to13rt = ((masterwide$Income2013-masterwide$Income2002)/masterwide$Income2002)/(2013-2002)
masterwide$growth93to13rt = ((masterwide$Income2013-masterwide$Income1993)/masterwide$Income1993)/(2013-1993)
masterwide$growth08to13rt = ((masterwide$Income2013-masterwide$Income2008)/masterwide$Income2008)/(2013-2008)
masterwide$growth13to15rt = ((masterwide$Income2015-masterwide$Income2013)/masterwide$Income2013)/(2015-2013)
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt,group=growth13to15rt,color=growth13to15rt))+
geom_line(aes(x=HC,y=growth03to15rt,group=growth03to15rt,color=growth03to15rt))+
geom_line(aes(x=HC,y=growth93to15rt,group=growth93to15rt,color=growth93to15rt))+
geom_line(aes(x=HC,y=growth08to15rt,group=growth08to15rt,color=growth08to15rt))+
theme_classic()
masterwide$growth87to08rt = ((masterwide$Income2008-masterwide$Income1987)/masterwide$Income1987)/(2008-1987)
masterwide$growth03to15rt = ((masterwide$Income2015-masterwide$Income2002)/masterwide$Income2002)/(2015-2002)
masterwide$growth93to15rt = ((masterwide$Income2015-masterwide$Income1993)/masterwide$Income1993)/(2015-1993)
masterwide$growth08to15rt = ((masterwide$Income2015-masterwide$Income2008)/masterwide$Income2008)/(2015-2008)
masterwide$growth13to15rt = ((masterwide$Income2015-masterwide$Income2013)/masterwide$Income2013)/(2015-2013)
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt,group=growth13to15rt,color=growth13to15rt))+
geom_line(aes(x=HC,y=growth03to15rt,group=growth03to15rt,color=growth03to15rt))+
geom_line(aes(x=HC,y=growth93to15rt,group=growth93to15rt,color=growth93to15rt))+
geom_line(aes(x=HC,y=growth08to15rt,group=growth08to15rt,color=growth08to15rt))+
theme_classic()
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt,group=growth13to15rt,color=growth13to15rt))+
#geom_line(aes(x=HC,y=growth03to15rt,group=growth03to15rt,color=growth03to15rt))+
#geom_line(aes(x=HC,y=growth93to15rt,group=growth93to15rt,color=growth93to15rt))+
#geom_line(aes(x=HC,y=growth08to15rt,group=growth08to15rt,color=growth08to15rt))+
theme_classic()
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
#geom_line(aes(x=HC,y=growth03to15rt,group=growth03to15rt,color=growth03to15rt))+
#geom_line(aes(x=HC,y=growth93to15rt,group=growth93to15rt,color=growth93to15rt))+
#geom_line(aes(x=HC,y=growth08to15rt,group=growth08to15rt,color=growth08to15rt))+
theme_classic()
# geom_line(aes(x=HC,y=growth13to15rt))+
geom_line(aes(x=HC,y=growth03to15rt)+
ggplot(masterwide,aes(x=HC))+
# geom_line(aes(x=HC,y=growth13to15rt))+
geom_line(aes(x=HC,y=growth03to15rt))+
#geom_line(aes(x=HC,y=growth93to15rt))+
#geom_line(aes(x=HC,y=growth08to15rt))+
theme_classic()
)
ggplot(masterwide,aes(x=HC))+
# geom_line(aes(x=HC,y=growth13to15rt))+
geom_line(aes(x=HC,y=growth03to15rt))+
#geom_line(aes(x=HC,y=growth93to15rt))+
#geom_line(aes(x=HC,y=growth08to15rt))+
theme_classic()
ggplot(masterwide,aes(x=HC))+
# geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
geom_line(aes(x=HC,y=growth93to15rt))+
#geom_line(aes(x=HC,y=growth08to15rt))+
theme_classic()
ggplot(masterwide,aes(x=HC))+
# geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
geom_line(aes(x=HC,y=growth93to15rt))+
#geom_line(aes(x=HC,y=growth08to15rt))+
theme_classic()
ggplot(masterwide,aes(x=HC))+
# geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
geom_line(aes(x=HC,y=growth08to15rt))+
theme_classic()
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
# geom_line(aes(x=HC,y=growth08to15rt))+
theme_classic()
View(agg_total)
load("data/AGGPovcalScrape1May2018.RData")
View(agg_total)
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
# geom_line(aes(x=HC,y=growth08to15rt))+
labs(x="Global Income Percentile",y="Income Growth rate\n2013-2015")+
scale_y_continuous(labels= scales::percent)
ggplot(masterwide,aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
# geom_line(aes(x=HC,y=growth08to15rt))+
labs(x="Global Income Percentile",y="Income Growth rate\n2013-2015")+
scale_y_continuous(labels= scales::percent)+
theme_classic()
ggplot(masterwide[which(masterwide$HC!=100)],aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
# geom_line(aes(x=HC,y=growth08to15rt))+
labs(x="Global Income Percentile",y="Income Growth rate\n2013-2015")+
scale_y_continuous(labels= scales::percent)+
theme_classic()
ggplot(masterwide[which(masterwide$HC!=100),],aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
# geom_line(aes(x=HC,y=growth08to15rt))+
labs(x="Global Income Percentile",y="Income Growth rate\n2013-2015")+
scale_y_continuous(labels= scales::percent)+
theme_classic()
View(agg_total)
#Loading PovcalNet data
load("data/AGGPovcalScrapeSept2018.RData")
masterlist=list()
masterlist.index=1
for (i in
c(seq(.01,.99,by=.01),
seq(.991,.999,by=.001)
)){
print(i)
new=data.table(agg_total[which(agg_total$regionCID=="WLD")])[,.SD[which.min(abs(hc-i))],by=c("requestYear")]
masterlist[[masterlist.index]]=new
masterlist.index=masterlist.index+1
}
master=rbindlist(masterlist)
master=master[,c("hc","povertyLine","requestYear","regionCID")]
master=master[order(master$requestYear, master$hc),]
master$HC=seq(1,100,by=1)
masterlist=list()
masterlist.index=1
for (i in
c(seq(.01,.99,by=.01),
seq(.991,1,by=.001)
)){
print(i)
new=data.table(agg_total[which(agg_total$regionCID=="WLD")])[,.SD[which.min(abs(hc-i))],by=c("requestYear")]
masterlist[[masterlist.index]]=new
masterlist.index=masterlist.index+1
}
master=rbindlist(masterlist)
master=master[,c("hc","povertyLine","requestYear","regionCID")]
master=master[order(master$requestYear, master$hc),]
master$HC=c(seq(1,99,by=1),
seq(99.1,100,by=.1))
years=c(unique(master$requestYear))
years=years[order(years)]
headcounts=unique(master$hc)
countries=unique(master$regionCID)
master=data.frame(master)
if(exists("masterwide")){
rm(masterwide)
}
for(year in years){
year.values=c()
year.hcs=c()
year.nam=paste0("Income",year)
year.values=subset(master, requestYear==year)[c("HC","povertyLine")]
setnames(year.values,"povertyLine",year.nam)
if(exists("masterwide")){
masterwide=merge(masterwide,year.values,by="HC",all=T)
}
else{
masterwide=year.values
}
}
masterwide$growth87to08rt = ((masterwide$Income2008-masterwide$Income1987)/masterwide$Income1987)/(2008-1987)
masterwide$growth03to15rt = ((masterwide$Income2015-masterwide$Income2002)/masterwide$Income2002)/(2015-2002)
masterwide$growth93to15rt = ((masterwide$Income2015-masterwide$Income1993)/masterwide$Income1993)/(2015-1993)
masterwide$growth08to15rt = ((masterwide$Income2015-masterwide$Income2008)/masterwide$Income2008)/(2015-2008)
masterwide$growth13to15rt = ((masterwide$Income2015-masterwide$Income2013)/masterwide$Income2013)/(2015-2013)
ggplot(masterwide[which(masterwide$HC!=100),],aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
# geom_line(aes(x=HC,y=growth08to15rt))+
labs(x="Global Income Percentile",y="Income Growth rate\n2013-2015")+
scale_y_continuous(labels= scales::percent)+
theme_classic()
ggplot(masterwide[which(masterwide$HC!=100),],aes(x=HC))+
geom_line(aes(x=HC,y=growth13to15rt))+
# geom_line(aes(x=HC,y=growth03to15rt))+
# geom_line(aes(x=HC,y=growth93to15rt))+
# geom_line(aes(x=HC,y=growth08to15rt))+
labs(x="Global Income Percentile",y="Income growth rate\n2013-2015")+
scale_y_continuous(labels= scales::percent)+
theme_classic()
#
P20incometrends <- read_csv("data/P20incometrends.csv")
View(P20incometrends)
table(P20incometrends$PovertyLine,P20incometrends$RequestYear)
